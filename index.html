<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Easy English Adventure - Fixed</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(#67c7ff, #b97cff);
            min-height: 100vh;
            color: white;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* ================== OVERLAY ================== */
        #startOverlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            font-size: 24px;
            cursor: pointer;
            text-align: center;
            padding: 20px;
        }

        /* ================== TOP BAR (Navigasi) ================== */
        .topbar {
            position: fixed;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 12px;
            z-index: 9999; /* Pastikan paling depan */
        }
        .topbar button {
            background: #ffdd00;
            border: 2px solid #000;
            padding: 10px 15px;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 3px 3px 0px #000;
            color: black;
            font-family: 'Comic Sans MS', cursive;
        }
        .topbar button:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0px #000; }

        /* ================== SCREEN SYSTEM ================== */
        .screen {
            display: none;
            width: 100%;
            max-width: 500px;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            animation: fade .5s;
            padding: 20px;
        }
        .active { display: flex; }

        @keyframes fade { from { opacity: 0; } to { opacity: 1; } }

        h1, h2 { text-shadow: 3px 3px #000; text-align: center; margin: 10px 0; }

        /* ================== OPTIONS (Perbaikan Ketindihan) ================== */
        .option-container {
            display: flex;
            flex-direction: column;
            gap: 15px; /* Memberi jarak antar tombol putih */
            width: 100%;
            padding: 10px;
            z-index: 10;
        }

        .option {
            background: white;
            color: black;
            border-radius: 15px;
            padding: 18px;
            width: 100%;
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: 0.2s;
            box-shadow: 0 4px 0px #ccc;
            border: none;
        }
        .option:hover { background: #f0f0f0; }
        .option.correct { background: #4cff4c !important; color: white; }
        .option.wrong { background: #ff4c4c !important; color: white; }

        /* ================== GAME UI ================== */
        #timer { font-size: 32px; color: #ffeb3b; font-weight: bold; text-shadow: 2px 2px #000; }
        .progress {
            width: 90%;
            height: 25px;
            background: rgba(255,255,255,0.3);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid #000;
        }
        .progress div { height: 100%; background: #00ff00; width: 0%; transition: width 0.3s; }
        
        .main-btn {
            padding: 15px 40px;
            border-radius: 25px;
            border: 2px solid #000;
            font-size: 22px;
            background: #ffcc00;
            cursor: pointer;
            box-shadow: 4px 4px 0px #000;
            font-family: 'Comic Sans MS', cursive;
            color: black;
        }
    </style>
</head>

<body>

    <div id="startOverlay">
        <h1>Easy English Adventure</h1>
        <p>üëâ Klik di mana saja untuk mulai & aktifkan suara üëà</p>
    </div>

    <div class="topbar">
        <button onclick="goHome()">üè† Home</button>
        <button id="musicBtn">üéµ Music: ON</button>
    </div>

    <div id="home" class="screen active">
        <h1>Easy English Adventure</h1>
        <button class="main-btn" onclick="openWorld()">Start Adventure</button>
    </div>

    <div id="world" class="screen">
        <h2>Choose Topic</h2>
        <button class="main-btn" style="margin-bottom:10px" onclick="startGame('colors')">Colors</button>
        <button class="main-btn" style="margin-bottom:10px" onclick="startGame('animals')">Animals</button>
        <button class="main-btn" onclick="startGame('numbers')">Numbers</button>
    </div>

    <div id="game" class="screen">
        <h2 id="question">Find: ...</h2>
        <div id="timer">5</div>
        <div class="progress"><div id="bar"></div></div>
        <div class="option-container" id="options"></div>
    </div>

    <div id="gameover" class="screen">
        <h1 id="msg">Game Over</h1>
        <h2 id="scoreText">Score: 0 / 15</h2>
        <button class="main-btn" onclick="retry()">Try Again</button>
    </div>

    <audio id="bgm" loop src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0d82b1f3f3.mp3"></audio>
    <audio id="correctSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_6b9a2e0c3a.mp3"></audio>
    <audio id="wrongSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_76b81b0b20.mp3"></audio>

    <script>
        const bgm = document.getElementById("bgm");
        const musicBtn = document.getElementById("musicBtn");
        const startOverlay = document.getElementById("startOverlay");

        /* ========== DATA ========== */
        const data = {
            colors: ["Red","Blue","Green","Yellow","Black","White","Pink","Purple","Orange","Brown","Gray","Cyan","Gold","Silver","Violet"],
            animals: ["Cat","Dog","Bird","Cow","Fish","Horse","Lion","Tiger","Elephant","Duck","Goat","Sheep","Monkey","Frog","Rabbit"],
            numbers: ["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"]
        };

        let topic = "", current = 0, score = 0, time = 5, timer;

        /* ========== FIX AUTOPLAY & OVERLAY ========== */
        startOverlay.addEventListener("click", () => {
            bgm.play().catch(e => console.log("Audio play failed", e));
            startOverlay.style.display = "none";
        });

        /* ========== MUSIC TOGGLE ========== */
        musicBtn.addEventListener("click", (e) => {
            e.stopPropagation(); // Mencegah trigger elemen di bawahnya
            if (bgm.paused) {
                bgm.play();
                musicBtn.innerText = "üéµ Music: ON";
                musicBtn.style.opacity = "1";
            } else {
                bgm.pause();
                musicBtn.innerText = "üéµ Music: OFF";
                musicBtn.style.opacity = "0.7";
            }
        });

        /* ========== NAVIGATION ========== */
        function show(id) {
            document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
            document.getElementById(id).classList.add("active");
        }
        function goHome() { clearInterval(timer); show("home"); }
        function openWorld() { show("world"); }

        /* ========== GAME LOGIC ========== */
        function startGame(t) {
            topic = t;
            current = 0;
            score = 0;
            show("game");
            nextQ();
        }

        function nextQ() {
            if (current >= 15) { endGame(); return; }
            clearInterval(timer);
            
            let correct = data[topic][current];
            document.getElementById("question").innerText = "Find: " + correct;

            // Acak pilihan
            let opts = [correct];
            while (opts.length < 3) {
                let r = data[topic][Math.floor(Math.random() * 15)];
                if (!opts.includes(r)) opts.push(r);
            }
            opts.sort(() => Math.random() - 0.5);

            // Tampilkan pilihan
            let html = "";
            opts.forEach(o => {
                html += <button class="option" onclick="answer(this,'${o}','${correct}')">${o}</button>;
            });
            document.getElementById("options").innerHTML = html;

            // Timer & Progress
            time = 5;
            document.getElementById("timer").innerText = time;
            document.getElementById("bar").style.width = (current / 15 * 100) + "%";

            timer = setInterval(() => {
                time--;
                document.getElementById("timer").innerText = time;
                if (time <= 0) {
                    clearInterval(timer);
                    current++;
                    nextQ();
                }
            }, 1000);
        }

        function answer(el, a, c) {
            clearInterval(timer);
            // Disable klik agar tidak double klik
            const buttons = document.querySelectorAll(".option");
            buttons.forEach(b => b.style.pointerEvents = "none");

            if (a == c) {
                el.classList.add("correct");
                document.getElementById("correctSound").play();
                score++;
            } else {
                el.classList.add("wrong");
                document.getElementById("wrongSound").play();
            }
            
            setTimeout(() => {
                current++;
                nextQ();
            }, 800);
        }

        function endGame() {
            show("gameover");
            document.getElementById("scoreText").innerText = "Score: " + score + " / 15";
            let msg = score > 10 ? "Great Job!" : "Keep Learning!";
            if (score === 15) msg = "Fantastic!";
            document.getElementById("msg").innerText = msg;
        }

        function retry() { startGame(topic); }
    </script>
</body>
</html>
